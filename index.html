<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport settings for perfect mobile scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omni-Translate AI: Autonomous System</title>
    <!-- Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (Visuals) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tesseract.js (Client-side OCR Engine - No Backend) -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    
    <style>
        /* Custom Animations */
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fade-in-right {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-scan {
            animation: scan 2.5s ease-in-out infinite;
        }

        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }

        .animate-fade-in-right {
            animation: fade-in-right 0.7s ease-out forwards;
        }

        .clip-path-polygon {
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        .text-shadow-glow {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Hide scrollbar for cleaner look */
        body::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="min-h-[100dvh] bg-gray-950 text-green-400 font-mono overflow-x-hidden relative selection:bg-green-500 selection:text-black">

    <!-- Matrix Rain Canvas -->
    <canvas id="matrix-canvas" class="fixed top-0 left-0 w-full h-full opacity-10 pointer-events-none z-0"></canvas>

    <!-- Hidden Canvas for Image Capture/OCR Processing -->
    <canvas id="capture-canvas" class="hidden"></canvas>
    
    <!-- Hidden File Input -->
    <input type="file" id="file-upload" accept="image/*" class="hidden" onchange="handleFileUpload(event)">

    <!-- HUD Overlay -->
    <div class="relative z-10 flex flex-col min-h-[100dvh] p-2 md:p-6 max-w-7xl mx-auto">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-4 md:mb-6 border-b border-green-500/30 pb-4 bg-gray-900/80 backdrop-blur p-4 rounded-lg shadow-[0_0_15px_rgba(0,255,0,0.1)]">
            <div class="flex items-center gap-3">
                <div class="bg-green-500/10 p-2 rounded border border-green-500/50 animate-pulse">
                    <i data-lucide="cpu" class="w-6 h-6 md:w-8 md:h-8 text-green-400"></i>
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 uppercase drop-shadow-[0_0_5px_rgba(0,255,0,0.8)]">
                        Omni-Translate <span class="text-[10px] md:text-xs align-top border border-green-500 px-1 rounded ml-1 text-green-400">MOBILE_CORE</span>
                    </h1>
                    <p class="text-[10px] md:text-xs text-cyan-400 tracking-wider">AUTONOMOUS JURIDICAL DECODER</p>
                </div>
            </div>
            <div class="hidden md:flex gap-4 text-xs font-bold text-green-600">
                <div class="flex items-center gap-1">
                    <i data-lucide="globe" class="w-4 h-4"></i> DATABASE: LEGAL
                </div>
                <div class="flex items-center gap-1">
                    <i data-lucide="shield" class="w-4 h-4"></i> PROTOCOL: SECURE
                </div>
            </div>
        </header>

        <!-- Main Interface Grid -->
        <main class="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6 pb-6">
            
            <!-- Left Column: Camera Feed -->
            <div class="lg:col-span-7 flex flex-col gap-4">
                <!-- Height adjusted for mobile: h-[50vh] ensures it fits on screen but leaves room for button -->
                <div class="relative w-full bg-black rounded-xl border-2 border-green-500/30 overflow-hidden shadow-[0_0_30px_rgba(0,255,0,0.15)] group h-[50vh] md:h-[600px] lg:h-auto lg:aspect-video flex flex-col">
                    
                    <!-- STARTUP OVERLAY (Click to Init) -->
                    <div id="start-overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-gray-900/95 backdrop-blur">
                        <div class="relative mb-6 group cursor-pointer" onclick="startSystem()">
                            <div class="absolute inset-0 bg-green-500 blur-xl opacity-20 group-hover:opacity-40 transition-opacity"></div>
                            <i data-lucide="power" class="w-16 h-16 text-green-500 relative z-10 animate-pulse"></i>
                        </div>
                        <div class="flex flex-col gap-4 w-full max-w-xs px-4">
                            <button onclick="startSystem()" class="w-full px-6 py-4 bg-transparent border-2 border-green-500 text-green-500 font-bold text-lg uppercase tracking-[0.2em] hover:bg-green-500 hover:text-black hover:shadow-[0_0_30px_rgba(0,255,0,0.6)] transition-all duration-300 clip-path-polygon">
                                INITIALIZE CAMERA
                            </button>
                            <button onclick="triggerFileUpload()" class="w-full px-6 py-3 bg-gray-800 border border-cyan-500/50 text-cyan-400 font-bold text-sm uppercase tracking-widest hover:bg-cyan-500/20 hover:text-cyan-200 transition-all duration-300 rounded flex items-center justify-center gap-2">
                                <i data-lucide="upload" class="w-4 h-4"></i> UPLOAD DATA
                            </button>
                        </div>
                        <p class="mt-4 text-green-500/50 text-xs tracking-widest text-center px-4">ENGAGE SENSORS OR LOAD FILE</p>
                    </div>

                    <!-- Upload Button (Persistent) -->
                    <div class="absolute top-4 right-4 z-40 hidden" id="persistent-upload-btn">
                        <button onclick="triggerFileUpload()" class="bg-black/60 backdrop-blur border border-cyan-500/50 text-cyan-400 p-2 rounded hover:bg-cyan-500/20 transition-all hover:scale-110" title="Upload Image">
                            <i data-lucide="upload" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Corner Accents -->
                    <div class="absolute top-0 left-0 w-8 h-8 md:w-12 md:h-12 border-t-4 border-l-4 border-cyan-400 z-20 rounded-tl-lg"></div>
                    <div class="absolute top-0 right-0 w-8 h-8 md:w-12 md:h-12 border-t-4 border-r-4 border-cyan-400 z-20 rounded-tr-lg"></div>
                    <div class="absolute bottom-0 left-0 w-8 h-8 md:w-12 md:h-12 border-b-4 border-l-4 border-cyan-400 z-20 rounded-bl-lg"></div>
                    <div class="absolute bottom-0 right-0 w-8 h-8 md:w-12 md:h-12 border-b-4 border-r-4 border-cyan-400 z-20 rounded-br-lg"></div>

                    <!-- Camera/Video Area -->
                    <div class="relative w-full h-full flex items-center justify-center bg-gray-900 overflow-hidden">
                        <video id="webcam" autoplay muted playsinline class="w-full h-full object-cover opacity-90 hidden"></video>
                        
                        <!-- Image Preview (For Uploads) -->
                        <img id="uploaded-image" class="w-full h-full object-contain bg-black hidden opacity-90" alt="Uploaded Content" />

                        <!-- Placeholder if no camera/image -->
                        <div id="camera-placeholder" class="flex flex-col items-center justify-center text-green-500/50 p-4 text-center">
                            <i data-lucide="camera" class="w-12 h-12 md:w-16 md:h-16 mb-4 animate-bounce"></i>
                            <p id="placeholder-text" class="tracking-widest text-sm md:text-base">SYSTEM STANDBY</p>
                        </div>
                        
                        <!-- Scanning Laser Animation (Hidden by default) -->
                        <div id="scan-laser" class="absolute top-0 left-0 w-full h-2 bg-cyan-400 shadow-[0_0_30px_#00FFFF] animate-scan opacity-90 z-10 hidden"></div>
                        
                        <!-- Grid Overlay -->
                        <div class="absolute inset-0 bg-[linear-gradient(rgba(0,255,0,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,0,0.05)_1px,transparent_1px)] bg-[size:40px_40px] pointer-events-none"></div>
                        
                        <!-- Center Target -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-32 md:w-72 md:h-48 border-2 border-green-500/40 rounded-lg pointer-events-none flex items-center justify-center">
                            <div class="absolute -top-1 -left-1 w-3 h-3 bg-green-400"></div>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400"></div>
                            <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-green-400"></div>
                            <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-400"></div>
                            <div id="target-text" class="text-cyan-400 text-[10px] md:text-xs font-bold bg-black/50 px-2 rounded tracking-widest animate-pulse hidden">LOCKING TARGET</div>
                        </div>

                        <!-- Status Text Overlay -->
                        <div class="absolute top-4 md:top-6 left-6 right-6 flex justify-center">
                           <div id="status-pill" class="bg-black/70 backdrop-blur border border-green-500/50 px-4 py-1 md:px-6 md:py-2 rounded-full text-green-400 font-bold tracking-widest shadow-[0_0_10px_rgba(0,255,0,0.3)] text-xs md:text-sm whitespace-nowrap overflow-hidden text-ellipsis max-w-[90%]">
                              AWAITING INIT
                           </div>
                        </div>
                    </div>

                    <!-- Scan Button Overlay -->
                    <div class="absolute bottom-6 md:bottom-8 left-1/2 transform -translate-x-1/2 z-30 w-11/12 md:w-64">
                        <button 
                            id="scan-btn"
                            disabled
                            onclick="initiateScan()"
                            class="w-full relative px-8 py-3 md:py-4 bg-black/80 backdrop-blur-md border-2 border-cyan-400 text-cyan-400 font-bold text-base md:text-lg uppercase tracking-[0.2em] hover:bg-cyan-400 hover:text-black hover:shadow-[0_0_30px_rgba(0,255,255,0.6)] transition-all duration-300 clip-path-polygon disabled:opacity-50 disabled:cursor-not-allowed group-hover:scale-105 active:scale-95 touch-manipulation"
                        >
                            INITIATE SCAN
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Result Card -->
            <div class="lg:col-span-5 flex flex-col">
                <div class="flex-1 bg-gray-900/60 backdrop-blur-md border border-cyan-500/30 p-1 rounded-xl shadow-[0_0_20px_rgba(0,255,255,0.05)] flex flex-col relative overflow-hidden min-h-[300px]">
                    
                    <!-- Card Header -->
                    <div class="bg-gray-900/80 p-3 md:p-4 border-b border-green-500/20 flex justify-between items-center rounded-t-lg">
                        <div class="flex items-center gap-2 text-cyan-400">
                            <i data-lucide="scale" class="w-4 h-4 md:w-5 md:h-5"></i>
                            <span class="font-bold tracking-wider text-sm md:text-base">LEGAL ANALYSIS</span>
                        </div>
                        <span id="confidence-badge" class="hidden bg-green-500/20 text-green-400 text-[10px] md:text-xs px-2 py-1 rounded border border-green-500/50"></span>
                    </div>

                    <!-- Card Body -->
                    <div class="flex-1 p-4 md:p-6 flex flex-col justify-center relative">
                        <!-- Background Grid inside card -->
                        <div class="absolute inset-0 bg-[linear-gradient(45deg,rgba(0,255,255,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none"></div>

                        <!-- Standby State -->
                        <div id="result-standby" class="flex flex-col items-center justify-center text-gray-600 space-y-4 opacity-40">
                            <div class="w-16 h-16 md:w-24 md:h-24 rounded-full border-4 border-dashed border-gray-700 flex items-center justify-center animate-spin-slow">
                                <i data-lucide="refresh-cw" class="w-8 h-8 md:w-10 md:h-10"></i>
                            </div>
                            <p class="text-xs md:text-sm tracking-[0.2em] uppercase">System Standby</p>
                        </div>

                        <!-- Result Content (Hidden by default) -->
                        <div id="result-content" class="space-y-6 md:space-y-8 hidden relative z-10">
                            
                            <!-- Detected Language Section -->
                            <div class="bg-black/40 p-3 md:p-4 rounded-lg border-l-4 border-cyan-500">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest">Detected Context</p>
                                    <span id="res-era" class="text-[9px] md:text-[10px] text-cyan-300 border border-cyan-500/30 px-1 rounded"></span>
                                </div>
                                <h2 id="res-detected" class="text-lg md:text-xl text-white font-serif tracking-wide text-shadow-glow"></h2>
                            </div>

                            <!-- Original Text Section -->
                            <div>
                                <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest mb-2 flex items-center gap-2">
                                    <i data-lucide="scroll" class="w-3 h-3"></i> Source Input
                                </p>
                                <div class="bg-green-900/10 border border-green-500/20 p-3 md:p-4 rounded-lg">
                                    <p id="res-original" class="text-xl md:text-2xl text-green-300 font-bold mb-2 break-words leading-relaxed" dir="auto"></p>
                                    <p id="res-translit" class="text-xs md:text-sm text-green-500/60 italic font-mono mt-2"></p>
                                </div>
                            </div>

                            <!-- Arrow Divider -->
                            <div class="flex justify-center text-cyan-500/50">
                                <div class="animate-bounce text-[10px] md:text-xs">
                                   ▼ PROCESSING ▼
                                </div>
                            </div>

                            <!-- Translation Section -->
                            <div>
                                <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest mb-2 flex items-center gap-2">
                                    <i data-lucide="gavel" class="w-3 h-3 text-yellow-400"></i> <span id="translation-label">Translation Output</span>
                                </p>
                                <div class="bg-gradient-to-br from-green-500/10 to-cyan-500/10 p-4 md:p-6 rounded-lg border border-cyan-400/30 shadow-[0_0_15px_rgba(0,255,255,0.1)] relative overflow-hidden group">
                                    <div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-cyan-400/20 to-transparent blur-xl"></div>
                                    <p id="res-hindi" class="text-2xl md:text-3xl text-cyan-100 font-bold leading-relaxed tracking-wide drop-shadow-md"></p>
                                </div>
                            </div>
                        </div>

                    </div>
                    
                    <!-- Footer Decor -->
                    <div class="h-1 w-full bg-gradient-to-r from-green-500 via-cyan-400 to-green-500"></div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- 1. Matrix Rain Effect ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const nums = '0123456789';
        const alphabet = latin + nums;
        
        const fontSize = 16;
        let columns = canvas.width / fontSize;
        const drops = [];

        function initDrops() {
            columns = canvas.width / fontSize;
            for (let x = 0; x < columns; x++) {
                drops[x] = 1;
            }
        }
        initDrops();

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 33);


        // --- 2. Fallback Scenarios (Simulation) ---
        const simulationScenarios = [
            {
                type: "text",
                detected: "Old Urdu (Court Terminology)",
                original: "مختار نامہ تحریر کیا گیا",
                transliteration: "Mukhtar-nama tehrir kiya gaya",
                result: "अधिकार पत्र (Power of Attorney) लिखा गया",
                confidence: "88.2%",
                era: "18th Century Legal"
            },
            {
                type: "text",
                detected: "Classical Arabic (Jurisprudence)",
                original: "الْبَيِّنَةُ عَلَى الْمُدَّعِي",
                transliteration: "Al-bayyinatu 'ala al-mudda'i",
                result: "प्रमाण का भार (Burden of Proof) वादी पर है",
                confidence: "91.9%",
                era: "Classical Fiqh"
            },
            {
                type: "number",
                detected: "Old Legal Year",
                original: "١٩٤٧",
                transliteration: "1947",
                result: "Nineteen Forty-Seven",
                confidence: "99.9%",
                era: "Independence Year"
            }
        ];

        // --- 3. Number to Words Logic ---
        function numberToEnglish(n) {
            const stringN = n.toString().replace(/,/g, '');
            const num = parseInt(stringN);
            
            if (isNaN(num)) return "Unknown Value";
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            
            if (num < 20) return ones[num];
            if (num < 100) return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? '-' + ones[num % 10] : '');
            if (num < 1000) return ones[Math.floor(num / 100)] + ' Hundred' + (num % 100 !== 0 ? ' ' + numberToEnglish(num % 100) : '');
            if (num < 1000000) return numberToEnglish(Math.floor(num / 1000)) + ' Thousand' + (num % 1000 !== 0 ? ' ' + numberToEnglish(num % 1000) : '');
            return "Value Too Large";
        }


        // --- 4. App Logic & OCR ---
        let isScanning = false;
        let mode = 'standby'; // standby, camera, upload
        
        const videoElement = document.getElementById('webcam');
        const uploadedImage = document.getElementById('uploaded-image');
        const fileInput = document.getElementById('file-upload');
        const captureCanvas = document.getElementById('capture-canvas');
        const placeholder = document.getElementById('camera-placeholder');
        const placeholderText = document.getElementById('placeholder-text');
        const laser = document.getElementById('scan-laser');
        const statusPill = document.getElementById('status-pill');
        const targetText = document.getElementById('target-text');
        const scanBtn = document.getElementById('scan-btn');
        const resultStandby = document.getElementById('result-standby');
        const resultContent = document.getElementById('result-content');
        const confidenceBadge = document.getElementById('confidence-badge');
        const translationLabel = document.getElementById('translation-label');
        const startOverlay = document.getElementById('start-overlay');
        const persistentUploadBtn = document.getElementById('persistent-upload-btn');

        // Initial setup
        lucide.createIcons();
        
        function startSystem() {
            startOverlay.classList.add('hidden');
            persistentUploadBtn.classList.remove('hidden');
            placeholderText.textContent = "INITIALIZING OPTICAL SENSORS...";
            initCamera();
        }

        // File Upload Handlers
        function triggerFileUpload() {
            fileInput.click();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                // Hide Start Overlay if it's open
                startOverlay.classList.add('hidden');
                persistentUploadBtn.classList.remove('hidden');

                // Switch to Upload Mode
                mode = 'upload';
                
                // UI Updates
                videoElement.classList.add('hidden');
                videoElement.pause();
                placeholder.classList.add('hidden');
                
                uploadedImage.src = e.target.result;
                uploadedImage.classList.remove('hidden');
                
                statusPill.textContent = "DATA LOADED. READY TO SCAN.";
                statusPill.classList.remove('text-yellow-400', 'text-green-400');
                statusPill.classList.add('text-cyan-400');
                
                scanBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function initCamera() {
            mode = 'camera';
            uploadedImage.classList.add('hidden');
            
            try {
                const constraints = { video: { facingMode: "environment" } };
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                videoElement.srcObject = stream;
                
                videoElement.onloadedmetadata = () => {
                   videoElement.play();
                   videoElement.classList.remove('hidden');
                   placeholder.classList.add('hidden');
                   statusPill.textContent = "OPTICAL SENSORS ACTIVE";
                   statusPill.classList.remove('text-yellow-400', 'text-cyan-400');
                   statusPill.classList.add('text-green-400');
                   scanBtn.disabled = false;
                };

            } catch (err) {
                console.warn("Camera access failed/denied. Switching to simulation mode.", err);
                statusPill.textContent = "SIMULATION MODE ACTIVE";
                statusPill.classList.remove('text-green-400', 'text-cyan-400');
                statusPill.classList.add('text-yellow-400');
                placeholderText.innerHTML = "CAMERA ACCESS DENIED<br><span class='text-[10px] md:text-xs text-green-500'>SYSTEM RUNNING IN SIMULATION</span>";
                placeholderText.classList.remove('text-green-500/50');
                placeholderText.classList.add('text-yellow-500', 'font-bold', 'text-center');
                videoElement.classList.add('hidden');
                placeholder.classList.remove('hidden');
                scanBtn.disabled = false;
            }
        }

        function initiateScan() {
            if (isScanning) return;
            isScanning = true;

            scanBtn.disabled = true;
            scanBtn.textContent = "SCANNING...";
            laser.classList.remove('hidden');
            targetText.classList.remove('hidden');
            resultContent.classList.add('hidden');
            resultContent.classList.remove('animate-fade-in-right');
            resultStandby.classList.remove('hidden');
            confidenceBadge.classList.add('hidden');
            statusPill.textContent = "SCANNING...";

            // Scroll for mobile visibility
            const scrollTarget = mode === 'upload' ? uploadedImage : videoElement;
            scrollTarget.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                scanBtn.textContent = "PROCESSING";
                laser.classList.add('hidden');
                targetText.classList.add('hidden');
                statusPill.textContent = "ANALYZING...";
                
                if (mode === 'camera' && !videoElement.classList.contains('hidden')) {
                    performRealOCR(videoElement);
                } else if (mode === 'upload') {
                    performRealOCR(uploadedImage);
                } else {
                    setTimeout(finishScanWithSimulation, 1500);
                }
            }, 2500);
        }

        async function performRealOCR(source) {
            statusPill.textContent = "EXTRACTING GLYPHS...";
            
            // Draw source to canvas for Tesseract
            captureCanvas.width = source.videoWidth || source.naturalWidth;
            captureCanvas.height = source.videoHeight || source.naturalHeight;
            const ctx = captureCanvas.getContext('2d');
            ctx.drawImage(source, 0, 0, captureCanvas.width, captureCanvas.height);
            const imageData = captureCanvas.toDataURL('image/png');

            try {
                const { data: { text, confidence } } = await Tesseract.recognize(
                    imageData,
                    'eng',
                    { logger: m => console.log(m) }
                );

                const cleanText = text.trim();
                console.log("OCR Result:", cleanText, "Confidence:", confidence);

                if (cleanText.length > 0 && confidence > 60) {
                    processRealText(cleanText, confidence);
                } else {
                    console.log("Low confidence/empty. Falling back to simulation.");
                    finishScanWithSimulation();
                }

            } catch (err) {
                console.error("OCR Failed:", err);
                finishScanWithSimulation();
            }
        }

        function processRealText(text, confidence) {
            const numberMatch = text.match(/^[\d,\.\s]+$/);
            
            let resultData = {
                type: "text",
                detected: "English / Latin Script",
                original: text,
                transliteration: "N/A",
                result: text, 
                confidence: Math.round(confidence) + "%",
                era: "Detected Input"
            };

            if (numberMatch) {
                const numVal = text.replace(/[^\d]/g, ''); 
                const englishWords = numberToEnglish(numVal);
                
                resultData.type = "number";
                resultData.detected = "Numeric Data";
                resultData.result = englishWords;
                resultData.era = "Real-Time OCR";
            } else {
                resultData.detected = "English / Latin Text";
                resultData.result = "Translation unavailable in standalone mode. (Text Captured)";
                
                if (text.length < 3) {
                    finishScanWithSimulation();
                    return;
                }
            }
            displayResult(resultData);
        }

        function finishScanWithSimulation() {
            const scenario = simulationScenarios[Math.floor(Math.random() * simulationScenarios.length)];
            displayResult(scenario);
        }

        function displayResult(scenario) {
            document.getElementById('res-era').textContent = scenario.era;
            document.getElementById('res-detected').textContent = scenario.detected;
            document.getElementById('res-original').textContent = scenario.original;
            
            if (scenario.transliteration !== "N/A") {
                document.getElementById('res-translit').textContent = `/${scenario.transliteration}/`;
                document.getElementById('res-translit').classList.remove('hidden');
            } else {
                document.getElementById('res-translit').classList.add('hidden');
            }
            
            if (scenario.type === 'number') {
                translationLabel.textContent = "Plain English Translation";
                document.getElementById('res-hindi').classList.add('font-mono'); 
            } else {
                translationLabel.textContent = "Legal Hindi / Output";
                document.getElementById('res-hindi').classList.remove('font-mono');
            }

            document.getElementById('res-hindi').textContent = scenario.result;
            confidenceBadge.textContent = `CONFIDENCE: ${scenario.confidence}`;
            confidenceBadge.classList.remove('hidden');

            resultStandby.classList.add('hidden');
            resultContent.classList.remove('hidden');
            resultContent.classList.add('animate-fade-in-right');

            statusPill.textContent = "ANALYSIS COMPLETE";
            scanBtn.textContent = "INITIATE SCAN";
            scanBtn.disabled = false;
            isScanning = false;
            
            lucide.createIcons();
            
            if(window.innerWidth < 768) {
                document.getElementById('result-content').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

    </script>
</body>
</html>